<!-- TODO: UNDO -->

<html>
<meta charset="UTF-8">
<head>
  <title>Piirtelyjuttu</title>
  <link rel="stylesheet" type="text/css" href="http://andriamanitra.me/draw.css">
</head>
<body onresize="set_offsets()">

<div id="left">
<div id="drawframe" onmousedown="klik(event)" onmouseup="deklik(event)">
  <canvas id="drawzone" width="800" height="450">
  If you see this text HTML5 Canvas is not supported by your browser.
  </canvas>
</div>

<div id="tools"></div>

<div id="right">
  <ul id="messages" tabindex="1"></ul>
  <form id="chatti" action="">
    <input type="text" id="nick" value="anon"><input id="msg" autocomplete="off" /><button id="chatsend">Send</button>
  </form>
</div>

<script src="http://andriamanitra.me/draw.js"></script>

<!-- chattisocketjutut -->
<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script>
  var tools = '<form name="Show"><div id="tools_sarake">Tools:<br><input type="radio" name="tool" value="line" checked> Line<br><input type="radio" name="tool" value="circle"> Circle<br><input type="radio" name="tool" value="oval"> Oval<br><input type="radio" name="tool" value="rect"> Rectangle<br></div><div id="tools_sarake"><input type="button" value="Undo" onclick="socket.emit(\'command\', \'undo\')"><input type="button" value="Clear" onclick="socket.emit(\'command\', \'clear\')"><br><input type="checkbox" name="Mid", value="true"> Start shape from center<br><input type="checkbox" name="Fill", value="true"> Fill<br></div><div id="tools_sarake"><input type="color" name="Color" value="#000000"><input type="button" id="vnap" value="    " style="background:#000000;" onclick="vaihda_vari(black)"><input type="button" id="vnap" value="    " style="background:#808080;" onclick="vaihda_vari(darkgray)"><input type="button" id="vnap" value="    " style="background:#C0C0C0;" onclick="vaihda_vari(lightgray)"><input type="button" id="vnap" value="    " style="background:#FFFFFF;" onclick="vaihda_vari(white)"><input type="button" id="vnap" value="    " style="background:#FF0000;" onclick="vaihda_vari(red)"><input type="button" id="vnap" value="    " style="background:#FFFF00;" onclick="vaihda_vari(yellow)"><input type="button" id="vnap" value="    " style="background:#00FF00;" onclick="vaihda_vari(green)"><input type="button" id="vnap" value="    " style="background:#00FFFF;" onclick="vaihda_vari(cyan)"><input type="button" id="vnap" value="    " style="background:#0000FF;" onclick="vaihda_vari(blue)"><input type="button" id="vnap" value="    " style="background:#FF00FF;" onclick="vaihda_vari(magenta)"></div><div id="koords">X: <input type="text" name="MouseX" value="0" size="4"><br>Y: <input type="text" name="MouseY" value="0" size="4"><br></div></form>'

  function piirtovuoroon() {
    document.getElementById("tools").innerHTML = tools;
    
    document.onmousemove = getMouseXY;
    document.getElementById("drawframe").onmousedown = klik;
    document.getElementById("drawframe").onmouseup = deklik;
  }

  function piirtovuorosta() {
    document.onmousemove = "";
    document.getElementById("drawframe").onmousedown = "";
    document.getElementById("drawframe").onmouseup = "";

    document.getElementById("tools").innerHTML = "";
  }

  function test() {
    if (document.getElementById("tools").innerHTML == "") {
      piirtovuoroon();
    }
    else {
      piirtovuorosta();
    }
  }

  piirtovuoroon();

  var socket = io();
  $('#nick').change(function(){
    socket.emit('command', "nick "+$('#nick').val());
  });
  $('form').submit(function(){
    var msg_val = $('#msg').val()
    if (msg_val[0] == '/') {
      if (msg_val.slice(1) == "test") { test() }
      socket.emit('command', msg_val.slice(1))
    }
    else {
      socket.emit('chat message', msg_val );
    }
    $('#msg').val('');
    return false;
  });
  socket.on('message', function(msg){
    $('#messages').append($('<li>').text(msg));
    $('#messages').scrollTop($('#messages')[0].scrollHeight);
  });
  socket.on('nick', function(newnick){
    $('#nick').val(newnick);
  });
  socket.on('muodot', function(muod){
    muodot = muod;
    refrsh();
  })
</script>

</body>
</html>